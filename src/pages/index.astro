---
import Layout from '../layouts/Layout.astro';
import Footer from '../components/Footer.astro';
---
<link rel="icon" type="image/png" href="/favicon.png">

<div class="hero">
    <img src="/public/logobw.png" alt="Logo" class="logo">
</div>

<Layout>
    <div class="contain">
        <div>
            <!-- Image Upload Button -->
            <button id="imgButton" class="button">Upload Image</button>
            <input id="ifileInput" type="file" accept="image/png, image/jpeg" class="hidden" onchange="handleFileUpload(event)" />

            <!-- Image Output -->
            <div id="output"></div>

            <!-- JSON Upload Button -->
            <button id="uploadButton" class="button">Upload JSON Final File</button>
            <input id="fileInput" type="file" accept="application/json" class="hidden" onchange="handleFileUpload(event)" />

            <div id="multiOutput"></div>
        </div>
    </div>
</Layout>

<div>
    <Footer />
</div>

<style>
    /* BUTTON STYLES */
    .button {
        display: block;
        margin: 10px auto;
        color: #000;
        background-color: #fff;
        border: 2px dashed #d4d4d4;
        padding: 12px 20px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
        text-align: center;
        width: 100%;
        max-width: 300px;
    }

    .button:hover {
        border-color: #EA9010;
        background-color: #EA9010;
        color: white;
        box-shadow: 0 4px 10px rgba(234, 144, 16, 0.6);
    }

    .button:active {
        background-color: rgba(234, 144, 16, 0.6);
    }

    /* HERO SECTION */
    .hero {
        width: 100%;
        height: 280px;
        background: linear-gradient(-45deg, #EA9010, #ea4310, #1055ea);
        background-size: 400% 400%;
        animation: gradientAnimation 20s ease infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
        border-radius: 20px;
    }

    @keyframes gradientAnimation {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* LOGO */
    .logo {
        max-width: 35%;
        height: auto;
    }

    /* PAGE LAYOUT */
    html {
        background-color: rgb(250, 250, 250);
        font-family: Roboto, sans-serif;
    }

    .contain {
        padding: 5%;
        margin: auto;
        max-width: 90%;
        width: 100%;
        text-align: center;
    }

    .shift {
        transform: translateY(-40px);
    }

    /* FILE INPUT */
    .hidden {
        display: none;
    }

    /* FILE PREVIEW */
    #output {
        margin-top: 20px;
    }

    #output img {
        max-width: 100%;
        height: auto;
        margin-top: 10px;
    }
</style>

<script type="module" client:load>
    const serverUrl = "https://eedd-142-244-6-66.ngrok-free.app/upload"; 
    
    document.getElementById("imgButton").addEventListener("click", function () {
        document.getElementById("ifileInput").click(); // Open file dialog
    });

    document.getElementById("ifileInput").addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (file) {
            if (file.type === "image/png" || file.type === "image/jpeg") {
                uploadFile(file);
            } 
        }
    });

    function uploadFile(file) {
        const formData = new FormData();
        formData.append("image", file);

        fetch(serverUrl, {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            console.log("Server Response:", data);
            
            if (data.fileUrl) {
                alert(`Image uploaded successfully: ${data.fileUrl}`);
                
                // Handle the image URL and display it
                const imgElement = document.createElement("img");
                imgElement.src = data.fileUrl;  // Use the returned URL from the server
                imgElement.alt = "Uploaded Image";
                imgElement.style.maxWidth = "100%";  // Optional: Add styles to the image

                // Append the image to the output div
                const outputDiv = document.getElementById("output");
                outputDiv.innerHTML = ''; // Clear previous output (if any)
                outputDiv.appendChild(imgElement);
            } else {
                alert("Error: Image URL not received from server.");
            }
        })
        .catch(error => {
            console.error("Upload Error:", error);
            alert("Failed to upload image.");
        });
    }
</script>
